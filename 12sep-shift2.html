<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>12 Sep Shift 1 — Mock</title>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<style>
  :root{--blue:#153d7a;--accent:#1f4d8a;--bg:#f3f6fb;--green:#28a745;--red:#d9534f}
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,Arial,Helvetica,sans-serif;background:var(--bg)}
  .centerStart{height:100vh;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:16px}
  .startBtn{padding:18px 28px;font-size:26px;border-radius:12px;background:linear-gradient(90deg,var(--blue),#2b62b0);color:#fff;border:0;cursor:pointer}
  .topbar{background:#fff;padding:10px 16px;display:flex;justify-content:space-between;align-items:center;box-shadow:0 6px 18px rgba(16,24,40,0.04)}
  .layout{display:flex;gap:12px;padding:12px;height:calc(100vh - 72px)}
  aside.left{width:260px;background:#fff;padding:12px;border-radius:10px;box-shadow:0 6px 18px rgba(16,24,40,0.04);overflow:auto}
  .qgrid{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
  .qnum{width:44px;height:36px;border-radius:6px;display:flex;align-items:center;justify-content:center;background:#eef6ff;border:0;cursor:pointer;font-weight:700}
  .qnum.answered{background:var(--green);color:#fff}
  .qnum.skipped{background:var(--red);color:#fff}
  .main{flex:1;display:flex;flex-direction:column}
  .controls-row{display:flex;gap:8px;align-items:center;padding:8px;background:#fff;border-radius:10px;box-shadow:0 6px 18px rgba(16,24,40,0.04)}
  .btn{padding:8px 12px;border-radius:8px;border:0;background:var(--accent);color:#fff;cursor:pointer;font-weight:700}
  .btn.ghost{background:#fff;color:var(--accent);border:1px solid #e6eef8}
  .timer{font-weight:900;padding:8px;border-radius:8px;background:#fff;border:1px solid #e6eef8}
  .qcard{background:#fff;margin-top:12px;border-radius:10px;padding:18px;box-shadow:0 6px 18px rgba(16,24,40,0.04);flex:1;overflow:auto}
  .opt{border:1px solid #e8eef8;padding:12px;border-radius:8px;display:flex;gap:10px;align-items:center;cursor:pointer;margin-bottom:8px}
  .overlayPaused{position:fixed;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,0.45);display:flex;align-items:center;justify-content:center;z-index:9999;color:#fff;font-size:28px}
  #resultsArea{display:none;padding:18px}
  table{border-collapse:collapse;width:100%}
  th,td{border:1px solid #e9eef8;padding:10px;text-align:left}
  @media(max-width:980px){.layout{flex-direction:column;height:auto}.left{width:100%;order:2}.main{order:1}}
</style>
</head>
<body>

<!-- START -->
<div id="startScreen" class="centerStart">
  <div style="text-align:center">
    <div style="font-size:14px;color:#6b7280">SSC CGL TIER I 2025</div>
    <div style="font-size:20px;font-weight:900">12 Sep — Shift 1 (Demo)</div>
    <div style="font-size:13px;color:#6b7280;margin-top:6px">Duration: 60 minutes</div>
  </div>
  <button id="startBtn" class="startBtn">START EXAM</button>
  <div style="margin-top:8px;color:#6b7280">Make sure you are logged in at the homepage</div>
</div>

<!-- APP -->
<div id="appWrap" style="display:none">
  <div class="topbar">
    <div><strong>12 Sep — Shift 1</strong></div>
    <div style="display:flex;gap:10px;align-items:center">
      <div class="timer" id="timeBox">60:00</div>
      <button id="pauseBtn" class="btn">Pause</button>
      <button id="submitBtn" class="btn">Submit</button>
    </div>
  </div>

  <div class="layout" id="layoutWrap">
    <aside class="left">
      <div style="font-weight:900;color:var(--blue)">Question Panel</div>
      <div class="qgrid" id="qGrid"></div>
      <div style="margin-top:12px;font-weight:700;color:#6b7280">Answered: <span id="answeredCount">0</span></div>
    </aside>

    <main class="main">
      <div class="controls-row">
        <button id="prevBtn" class="btn ghost">Previous</button>
        <button id="saveNextBtn" class="btn">Save & Next</button>
        <div style="margin-left:auto;color:#6b7280">Section Time: <span id="secTime">00:00</span></div>
      </div>

      <div class="qcard">
        <div class="qheader" id="qHeader">Question</div>
        <div class="qtext" id="qText">Loading...</div>
        <div class="options" id="optsWrap"></div>
      </div>
    </main>
  </div>

  <div id="resultsArea">
    <h2>Marks & Attempt Saved</h2>
    <div id="markCard"></div>
    <div style="margin-top:12px"><a href="index.html">Back to Home</a></div>
  </div>
</div>

<div id="pauseOverlay" class="overlayPaused" style="display:none">PAUSED</div>

<script>
/* SETTINGS */
const STORAGE_KEY = 'ssc_12sep_shift1_state_v1'; // unique per shift
const ATTEMPTS_KEY = 'ssc_attempts_v1';
const CURRENT_USER_KEY = 'ssc_current_user';

/* SAMPLE QUESTIONS (replace with your 1..100 later) */
const QUESTIONS = [
  {id:1, q:`In the following question, select the related word: Watt : Power :: Pascal : ?`, options:["A. Energy","B. Temperature","C. Pressure","D. Force"]},
  {id:2, q:`Mekong : Tibet :: Amazon : ?`, options:["A. Chile","B. Peru","C. Colombia","D. Ecuador"]},
  {id:3, q:`Select the letter-cluster that replaces ? in: CGK, GKO, KOS, OSW, ?`, options:["A. SDA","B. KNB","C. SWA","D. KJH"]},
  {id:4, q:`Arrange the fractions (3/4), (2/5), (5/7), (3/5) in ascending order.`, options:["A. 2/5, 3/5, 3/4, 5/7","B. 2/5, 3/5, 5/7, 3/4","C. 3/5, 2/5, 5/7, 3/4","D. 2/5, 5/7, 3/5, 3/4"]}
];

/* SAMPLE ANSWER KEY (A/B/C/D) */
const ANSWER_KEY = {"1":"C","2":"B","3":"C","4":"B"}; 

/* state */
let state = {
  index:0,
  answers:{}, // key: id -> "A"/"B"/...
  timer:60*60,
  running:false,
  paused:false,
  sectionTime:0
};

/* persistence */
function loadState(){
  try{
    const raw = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
    Object.assign(state, raw);
  }catch(e){}
}
function saveState(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }

/* ui helpers */
const el = id => document.getElementById(id);
function formatTime(s){ const m=Math.floor(s/60).toString().padStart(2,'0'); const ss=(s%60).toString().padStart(2,'0'); return `${m}:${ss}`; }

function buildGrid(){
  const wrap = el('qGrid'); wrap.innerHTML='';
  QUESTIONS.forEach((q, idx)=>{
    const btn = document.createElement('button');
    btn.className = 'qnum' + (state.answers[q.id] ? ' answered':'');
    btn.innerText = idx+1;
    btn.onclick = ()=>{ state.index = idx; renderQuestion(); saveState(); };
    wrap.appendChild(btn);
  });
  el('answeredCount').innerText = Object.keys(state.answers).length;
}

function renderQuestion(){
  const q = QUESTIONS[state.index];
  el('qHeader').innerText = `Q${q.id}`;
  el('qText').innerHTML = q.q;
  const optsWrap = el('optsWrap'); optsWrap.innerHTML='';
  const user = state.answers[q.id] || null;
  q.options.forEach(opt=>{
    const letterMatch = opt.trim().match(/^([A-D])\./i);
    const letter = letterMatch ? letterMatch[1].toUpperCase() : opt.trim().slice(0,1).toUpperCase();
    const div = document.createElement('div'); div.className='opt';
    const radio = document.createElement('input'); radio.type='radio'; radio.name='opt';
    radio.checked = user === letter;
    radio.onchange = ()=>{ state.answers[q.id] = letter; buildGrid(); saveState(); };
    div.appendChild(radio);
    const span = document.createElement('span'); span.innerText = opt;
    div.appendChild(span);
    div.onclick = ()=>{ radio.checked = true; radio.onchange(); };
    optsWrap.appendChild(div);
  });
}

/* navigation */
el('saveNextBtn').addEventListener('click', ()=>{
  if(state.index < QUESTIONS.length-1) state.index++;
  else state.index = 0;
  renderQuestion(); saveState();
});
el('prevBtn').addEventListener('click', ()=>{ if(state.index>0) state.index--; renderQuestion(); saveState(); });

/* timer */
let timerInterval = null;
function startTimer(){
  if(timerInterval) clearInterval(timerInterval);
  state.running = true; state.paused = false;
  timerInterval = setInterval(()=>{
    if(state.running && !state.paused){
      state.timer = Math.max(0,state.timer-1);
      state.sectionTime++;
      el('timeBox').innerText = formatTime(state.timer);
      el('secTime').innerText = formatTime(state.sectionTime);
      saveState();
      if(state.timer === 0){ clearInterval(timerInterval); submitExam(); }
    }
  }, 1000);
}
function pauseToggle(){
  state.paused = !state.paused;
  el('pauseOverlay').style.display = state.paused ? 'flex' : 'none';
  el('pauseBtn').innerText = state.paused ? 'Resume' : 'Pause';
  saveState();
}

/* submit and scoring */
function submitExam(){
  // compute marks: +2 correct, -0.5 wrong, 0 unanswered
  let marks = 0; let right=0, wrong=0, unanswered=0;
  QUESTIONS.forEach(q=>{
    const your = state.answers[q.id] || null;
    const corr = ANSWER_KEY[q.id.toString()] || null;
    if(!your) unanswered++;
    else if(your === corr){ right++; marks += 2; }
    else { wrong++; marks -= 0.5; }
  });
  // save attempt to global attempts storage under current user
  const user = localStorage.getItem(CURRENT_USER_KEY);
  if(user){
    const attemptsRaw = JSON.parse(localStorage.getItem(ATTEMPTS_KEY) || '{}');
    attemptsRaw[user] = attemptsRaw[user] || {};
    attemptsRaw[user]['12sep-shift1'] = {
      marks: marks.toFixed(2),
      right, wrong, unanswered,
      timeTaken: formatTime(state.sectionTime),
      date: new Date().toLocaleString()
    };
    localStorage.setItem(ATTEMPTS_KEY, JSON.stringify(attemptsRaw));
  }
  // show markcard
  el('layoutWrap').style.display = 'none';
  el('resultsArea').style.display = 'block';
  const mc = el('markCard');
  mc.innerHTML = `<p><strong>Score:</strong> ${marks.toFixed(2)} &nbsp; (<em>Right: ${right}, Wrong: ${wrong}, Unanswered: ${unanswered}</em>)</p>
                  <p><strong>Time:</strong> ${formatTime(state.sectionTime)}</p>
                  <p><strong>Saved for:</strong> ${user || 'not logged in'}</p>
                  <p><a href="index.html">Back to Home</a></p>`;
  // clear saved state for this run
  localStorage.removeItem(STORAGE_KEY);
}

/* wiring */
el('startBtn').addEventListener('click', async ()=>{
  // check logged in
  const user = localStorage.getItem(CURRENT_USER_KEY);
  if(!user){ alert('You must login first from the homepage.'); window.location.href='login.html'; return; }
  document.getElementById('startScreen').style.display='none';
  document.getElementById('appWrap').style.display='block';
  // init state from storage if exists
  loadState();
  buildGrid();
  renderQuestion();
  startTimer();
});
el('pauseBtn').addEventListener('click', ()=>{ pauseToggle(); });
el('submitBtn').addEventListener('click', ()=>{ if(confirm('Submit exam?')) submitExam(); });

/* restore on page load if had started */
loadState();
if(state.running && !state.paused){
  // show app immediately (useful if reloaded mid-test)
  document.getElementById('startScreen').style.display='none';
  document.getElementById('appWrap').style.display='block';
  buildGrid(); renderQuestion(); startTimer();
} else if(state.paused){
  document.getElementById('startScreen').style.display='none';
  document.getElementById('appWrap').style.display='block';
  buildGrid(); renderQuestion();
  el('pauseOverlay').style.display = 'flex';
  el('pauseBtn').innerText = 'Resume';
}

/* autosave every 2s */
setInterval(()=>{ saveState(); }, 2000);

</script>
</body>
</html>
